@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var mensagem = TempData["mensagem"]?.ToString() ?? "";
}

<div class="col-xs-3 col-sm-3 col-md-3 col-lg-3">
    <div style="background-color: white; padding: 10px; border-radius: 15px; box-shadow: 0 0 80px black; margin-top: 2%;">

        <h3>Usuarios</h3>
        <div id="tabela">
            <ul>
                <li>
                    <p>
                        <a class="btn-floating red"><i class="material-icons" id="Novo">playlist_add</i></a>
                    </p>
                </li>
            </ul>
            <div id="tabelaUsuarios"></div>            
        </div>
    </div>    
</div>

<div id="divContentUsuario" class="modal modal-fixed-footer"
     style="display: none; height: auto; width: 367px; z-index: 1003; opacity: 1; transform: scaleX(1); border-radius: 15px; top:10%;">
</div>

<script>

    $(document).ready(function () {

        $('.modal').modal();

        (function () {
            var msg = '@(!string.IsNullOrEmpty(mensagem)?mensagem:"")';

            if (msg != '') {
                Materialize.toast('' + msg + '', 4000, 'rounded red')
            }
        })();

        buscaTabelaUsuario();
    });

    var urlsUsuario = {
        Edit: '@Url.Action("Edit", "Usuario")',
        Details: '@Url.Action("Details", "Usuario")',
        Ativar: '@Url.Action("AtivarUsuario", "Usuario")',
        Desativar: '@Url.Action("DesativarUsuario", "Usuario")',
        Create: '@Url.Action("Create", "Usuario")',
        BuscaTabelaUsuario: '@Url.Action("BuscaGridUsuario", "Usuario")'
    }

    function buscaTabelaUsuario() {
        $.get(urlsUsuario.BuscaTabelaUsuario)
            .done(function (data) { $('#tabelaUsuarios').slideUp(100, function () { $("#tabelaUsuarios").html(data).slideDown(200); }) })
            .fail(function (xhr) { Materialize.toast('' + xhr.responseText + '', 4000, 'rounded red') })
    }

    function erro(xhr) { Materialize.toast('' + xhr.responseText + '', 4000, 'rounded red'); }

    function editar(id) {
        $.get(urlsUsuario.Edit, { id: id })
            .done(function (data) { $('#divContentUsuario').modal('open').html(data); })
            .fail(function (xhr) { Materialize.toast('' + xhr.responseText + '', 4000, 'rounded red') });
    };

    function detalhar(id) {
        $.get(urlsUsuario.Details, { id: id })
            .done(function (data) { $('#divContentUsuario').modal('open').html(data); })
            .fail(function (xhr) { Materialize.toast('' + xhr.responseText + '', 4000, 'rounded red') });
    };

    function desativar(id) {
        if (!confirm("Deseja realmente Desativar esse Usuario?")) return;

        $.get(urlsUsuario.Desativar, {
            id: id
        }).done(function () {
            buscaTabelaUsuario();
            $("#Acoes").hide();
        }).fail(function (xhr) {
            $("#Acoes").show();
            $("#Acoes").html(xhr.responseText);
        });
    };

    function ativar(id) {
        if (!confirm("Deseja realmente Ativar esse Usuario?")) return;

        $.get(urlsUsuario.Ativar, {
            id: id
        }).done(function () {
            buscaTabelaUsuario();
            $("#Acoes").hide();
        }).fail(function (xhr) {
            $("#Acoes").show();
            $("#Acoes").html(xhr.responseText);
        });
    };

    $("#Novo").click(function () {
        $.get(urlsUsuario.Create)
            .done(function (data) { $('#divContentUsuario').modal('open').html(data); })
            .fail(function (xhr) { Materialize.toast('' + xhr.responseText + '', 4000, 'rounded red') });
    });

    function escondeModal() {
        $("#divContentUsuario").modal('close');
    }

</script>